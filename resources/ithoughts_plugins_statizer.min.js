$(function(){function e(e){return JSON.parse(window.decodeURIComponent(e))}function t(e,t){return window.encodeURIComponent(e)+"___"+t}function i(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function s(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function n(e){if(e.options.fillColor){var t=e.options.fillColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),\s*(\d*.?\d*)\)/)
t={r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:parseFloat(t[4])}
var i=setInterval(function(){return e.pointAttr.hover.fill=="rgb("+t.r+","+t.g+","+t.b+")"?void clearInterval(i):(e.pointAttr.hover.fill="rgb("+t.r+","+t.g+","+t.b+")",void e.data.forEach(function(e){e.pointAttr.hover.fill="rgb("+t.r+","+t.g+","+t.b+")"}))},10)}}function a(){for(var e=0,a=ithoughts_plugins_statizer_plugins.length;a>e;e++){var r=ithoughts_plugins_statizer_plugins[e]
if(1!=r.inited){r.inited=!0
var o=null,l=r.maxDays,d=(new Date).getTime(),p=864e5
for(var u in r.plugins){var g=new Date(r.plugins[u].creationDate).getTime()
isNaN(g)&&(g=d)
var h=d
r.plugins[u].downloads&&(h=d-Object.keys(r.plugins[u].downloads).length*p)
var c=d
r.plugins[u].active&&(c=d-Object.keys(r.plugins[u].active).length*p)
var v=Math.max(Math.min(g,h,c),d-l*p)
v=i(new Date(v)),(null==o||o>v)&&(o=v)}$container=$("#"+r.chartId)
var f={chart:{type:"spline",alignTicks:!1,events:{redraw:function(){for(var e=0,t=this.series.length;t>e;e++)n(this.series[e])}}},title:{text:$container[0].getAttribute("data-title")},legend:{enabled:!1},xAxis:[{type:"datetime",title:{text:ithoughts_plugins_statizer.lang.labels.xAxisDate},plotLines:[],min:i(o).getTime(),dateTimeLabelFormats:{millisecond:"millisecond %H:%M:%S.%L",second:"second %H:%M:%S",minute:"minute %H:%M",hour:"hour %H:%M",day:"day %e. %b",week:ithoughts_plugins_statizer.lang.dateformat.week,month:ithoughts_plugins_statizer.lang.dateformat.month,year:"year %Y"}},{type:"datetime",title:{text:ithoughts_plugins_statizer.lang.labels.xAxisDate},plotLines:[],opposite:!0,visible:!1,min:i(o).getTime()}],plotOptions:{spline:{marker:{enabled:!1}}},tooltip:{formatter:function(){return this.point.text?'<span style="font-size:0.75em">'+Highcharts.dateFormat(ithoughts_plugins_statizer.lang.dateformat.full,new Date(this.x))+"</span><br/>"+this.point.text:'<span style="font-size:0.75em">'+Highcharts.dateFormat(ithoughts_plugins_statizer.lang.dateformat.full,new Date(this.x))+"</span><br/>"+this.series.name+":"+this.y}},yAxis:[{title:{text:ithoughts_plugins_statizer.lang.labels.yAxisDownloads},min:0,gridLineColor:r.colors.axis[0]},{title:{text:ithoughts_plugins_statizer.lang.labels.yAxisActive},opposite:!0,type:"logarithmic",allowDecimals:!1,tickInterval:1,min:1,gridLineColor:r.colors.axis[1]}],series:[]}
for(var u in r.plugins){var m
m=r.plugins[u].name?r.plugins[u].name:u
var x=Object.keys(r.plugins).indexOf(u)
r.seriesTable||(r.seriesTable={}),r.seriesTable[window.encodeURIComponent(m)]||(r.seriesTable[window.encodeURIComponent(m)]={})
var b=[],w=[]
for(var _ in r.plugins[u].downloads)b.push(r.plugins[u].downloads[_])
var y=Object.keys(r.plugins[u].downloads)
w.push({value:i(new Date(y[y.length-1])).getTime()-p,dashStyle:"solid"}),"undefined"!=typeof r.plugins[u].downloadsToday&&(w.push({value:i(new Date).getTime()+p,dashStyle:"shortdot"}),b.push(r.plugins[u].downloadsToday))
var I=t(m,"downloads"),A={type:"spline",yAxis:0,name:ithoughts_plugins_statizer.lang.labels.downloadSerie.format(m),data:b,pointStart:i(new Date).getTime()-(b.length-(r.plugins[u].downloadsToday?1:0))*p,pointInterval:p,id:I,color:"#"+r.colors.series[x][0]}
"undefined"!=typeof r.plugins[u].downloadsToday&&(A=$.extend(A,{zoneAxis:"x",zones:w})),f.series.push(A),r.seriesTable[window.encodeURIComponent(m)].downloads={id:I,name:m}
var b=[]
for(var _ in r.plugins[u].active)b.push(r.plugins[u].active[_])
var I=t(m,"active")
f.series.push({type:"line",yAxis:1,name:ithoughts_plugins_statizer.lang.labels.activeSerie.format(m),step:"center",data:b,pointStart:i(new Date).getTime()-b.length*p,pointInterval:p,id:I,color:"#"+r.colors.series[x][1]}),r.seriesTable[window.encodeURIComponent(m)].active={id:I,name:m}
var z=.5
if(r.plugins[u].events){if(r.plugins[u].events.versions){var T=s(r.colors.series[x][2]),O={type:"flags",xAxis:1,fillColor:"rgba("+T.r+","+T.g+","+T.b+","+z+")",data:[],name:m,shape:"flag",zIndex:10+x+2}
for(var D in r.plugins[u].events.versions){var k=r.plugins[u].events.versions[D]
O.data.push({x:i(new Date(D)).getTime(),title:"v"+k,text:ithoughts_plugins_statizer.lang.labels.eventVersion.format(k,m)})}f.series.push(O)}if(r.plugins[u].events.downloads){var T=s(r.colors.series[x][3]),C={yAxis:0,type:"flags",onSeries:t(m,"downloads"),fillColor:"rgba("+T.r+","+T.g+","+T.b+","+z+")",data:[],name:m,shape:"circlepin",zIndex:10+x+0}
for(var D in r.plugins[u].events.downloads){var S=r.plugins[u].events.downloads[D]
C.data.push({x:i(new Date(D)).getTime(),title:S,text:ithoughts_plugins_statizer.lang.labels.eventDownloads.format(S,m)})}f.series.push(C)}if(r.plugins[u].events.active){var T=s(r.colors.series[x][4]),L={yAxis:1,type:"flags",onSeries:t(m,"active"),fillColor:"rgba("+T.r+","+T.g+","+T.b+","+z+")",data:[],name:m,shape:"squarepin",zIndex:10+x+1}
for(var D in r.plugins[u].events.active){var j=r.plugins[u].events.active[D]
L.data.push({x:i(new Date(D)).getTime(),title:j,text:ithoughts_plugins_statizer.lang.labels.eventActive.format(j,m)})}f.series.push(L)}}}$container.find(".chart").highcharts(f,function(e){r.chart=e
var t=[]
for(var i in r.plugins)cplugin=r.plugins[i],cplugin.active&&-1==t.indexOf("active")&&t.push("active"),cplugin.downloads&&-1==t.indexOf("downloads")&&t.push("downloads"),cplugin.events&&Object.keys(cplugin.events).length>0&&-1==t.indexOf("events")&&t.push("events")
var s=$container.find(".customLegend"),a=$($.parseHTML("<table></table>"))
s.append(a)
var o=""
for(serie in t){var l=t[serie]
ithoughts_plugins_statizer.lang.labels[t[serie]]&&(l=ithoughts_plugins_statizer.lang.labels[t[serie]]),o+='<th class="item-group" data-direction="column">'+l+"</th>"}a.append($.parseHTML("<tr><th></th>"+o+"</tr>"))
var d={}
$.each(e.series,function(e,t){var i=t.userOptions.id
if(i){var s=i.split("___")
d[window.decodeURIComponent(s[0])]||(d[window.decodeURIComponent(s[0])]={}),d[window.decodeURIComponent(s[0])][s[1]]={index:e,color:t.color}}else if(d[t.userOptions.name]&&(d[t.userOptions.name].events||(d[t.userOptions.name].events=[])),t.options.fillColor){var a=t.options.fillColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),\s*(\d*.?\d*)\)/)
a={r:parseInt(a[1]),g:parseInt(a[2]),b:parseInt(a[3]),a:parseFloat(a[4])},d[t.userOptions.name]&&d[t.userOptions.name].events&&d[t.userOptions.name].events.push({index:e,color:"rgb("+a.r+","+a.g+","+a.b+")"})}else d[t.userOptions.name]&&d[t.userOptions.name].events&&d[t.userOptions.name].events.push({index:e,color:t.color})
n(t)})
var p=""
for(var u in d){p+='<tr><th class="item-group" data-direction="line">'+u+"</th>"
for(var g in t){var h=t[g]
if(d[u][h])if(d[u][h].constructor===Array){for(var c=[],v=[],f=0,m=d[u][h].length;m>f;f++)c.push(d[u][h][f].index),v.push('<div style="display:inline-block;background-color:'+d[u][h][f].color+';width:25px;height:5px;border-radius:5px;"></div>')
p+='<td class="item" data-index="'+c.join(", ")+'" style="text-align:center">'+v.join()+"</td>"}else p+='<td class="item" data-index="'+d[u][h].index+'" style="text-align:center"><div style="display:inline-block;background-color:'+d[u][h].color+';width:25px;height:5px;border-radius:5px;"></div></td>'
else p+="<td></td>"}p+="</tr>"}a.append($.parseHTML(p)),$container.find(".customLegend  .item").click(function(){var t=this.getAttribute("data-index"),i=this.getAttribute("data-active")
null==i&&(i=!0),"false"===i&&(i=!1),"true"===i&&(i=!0),i=!i,this.setAttribute("data-active",i)
var s
t.indexOf(",")>-1?(s=t.split(","),s.forEach(function(e,t,i){i[t]=parseInt(e)})):s=[parseInt(t)]
for(var n=0,a=s.length;a>n;n++)serie=e.series[s[n]],serie.setVisible(i)}),$container.find(".customLegend  .item-group").click(function(){var e=this.getAttribute("data-active")
switch(null==e&&(e=!0),"false"===e&&(e=!1),"true"===e&&(e=!0),e=!e,this.setAttribute("data-active",e),this.getAttribute("data-direction")){case"line":$(this).parent().find(".item").attr("data-active",!e).click()
break
case"column":$(this).parent().parent().find("tr td.item:nth-child("+($(this).index()+1)+")").attr("data-active",!e).click()}})})}}}String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var i=new RegExp("\\{"+t+"\\}","gi")
e=e.replace(i,arguments[t])}return e},Highcharts.setOptions({lang:ithoughts_plugins_statizer.lang.highcharts}),console.log(ithoughts_plugins_statizer_plugins),$('[id^="plugins_data-"][data-ajaxed="true"]').each(function(){var t=e(this.getAttribute("data-plugins")),i=e(this.getAttribute("data-details")),s=this.id,n=this.getAttribute("data-maxDays"),r=this.getAttribute("data-theme"),o={plugins:t,details:i,chartId:s}
parseInt(n)>0&&(o.maxDays=parseInt(n)),r&&r.length>0&&(o.theme=r),$.post(ithoughts_plugins_statizer.ajax,{action:"ithoughts_plugins_statizer-get_chart_ajax",data:o},function(e){e.success?(ithoughts_plugins_statizer_plugins.push(e.data),a()):console.error("Error while getting chart via Ajax",e)})})
a()})
