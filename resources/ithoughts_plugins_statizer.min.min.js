$(function(){function e(e){return JSON.parse(window.decodeURIComponent(e))}function t(e,t){return window.encodeURIComponent(e)+"___"+t}function i(e){return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e}function n(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function s(e){if(e.options.fillColor){var t=e.options.fillColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),\s*(\d*.?\d*)\)/)
t={r:parseInt(t[1]),g:parseInt(t[2]),b:parseInt(t[3]),a:parseFloat(t[4])}
var i=setInterval(function(){return e.pointAttr.hover.fill=="rgb("+t.r+","+t.g+","+t.b+")"?void clearInterval(i):(e.pointAttr.hover.fill="rgb("+t.r+","+t.g+","+t.b+")",void e.data.forEach(function(e){e.pointAttr.hover.fill="rgb("+t.r+","+t.g+","+t.b+")"}))},10)}}function a(){for(var e=0,a=ithoughts_plugins_statizer_plugins.length;a>e;e++){var r=ithoughts_plugins_statizer_plugins[e]
if(1!=r.inited){r.inited=!0
var o=null,l=100,d=(new Date).getTime(),p=864e5
for(var g in r.plugins){var u=new Date(r.plugins[g].creationDate).getTime()
isNaN(u)&&(u=d)
var c=d-Object.keys(r.plugins[g].downloads).length*p,h=d-Object.keys(r.plugins[g].active).length*p,v=Math.max(Math.min(u,c,h),d-l*p)
v=i(new Date(v)),(null==o||o>v)&&(o=v)}$container=$("#"+r.chartId)
var f={chart:{type:"spline",alignTicks:!1,events:{redraw:function(){for(var e=0,t=this.series.length;t>e;e++)s(this.series[e])}}},title:{text:$container[0].getAttribute("data-title")},legend:{enabled:!1},xAxis:[{type:"datetime",title:{text:ithoughts_plugins_statizer.lang.labels.xAxisDate},plotLines:[],min:i(o).getTime(),dateTimeLabelFormats:{millisecond:"millisecond %H:%M:%S.%L",second:"second %H:%M:%S",minute:"minute %H:%M",hour:"hour %H:%M",day:"day %e. %b",week:ithoughts_plugins_statizer.lang.dateformat.week,month:"month %b '%y",year:"year %Y"}},{type:"datetime",title:{text:ithoughts_plugins_statizer.lang.labels.xAxisDate},plotLines:[],opposite:!0,visible:!1,min:i(o).getTime()}],plotOptions:{spline:{marker:{enabled:!1}}},tooltip:{formatter:function(){return this.point.text?'<span style="font-size:0.75em">'+Highcharts.dateFormat(ithoughts_plugins_statizer.lang.dateformat.full,new Date(this.x))+"</span><br/>"+this.point.text:'<span style="font-size:0.75em">'+Highcharts.dateFormat(ithoughts_plugins_statizer.lang.dateformat.full,new Date(this.x))+"</span><br/>"+this.series.name+":"+this.y}},yAxis:[{title:{text:ithoughts_plugins_statizer.lang.labels.yAxisDownloads},min:0,gridLineColor:r.colors.axis[0]},{title:{text:ithoughts_plugins_statizer.lang.labels.yAxisActive},opposite:!0,type:"logarithmic",allowDecimals:!1,tickInterval:1,min:1,gridLineColor:r.colors.axis[1]}],series:[]}
for(var g in r.plugins){var m
m=r.plugins[g].name?r.plugins[g].name:g
var b=Object.keys(r.plugins).indexOf(g)
r.seriesTable||(r.seriesTable={}),r.seriesTable[window.encodeURIComponent(m)]||(r.seriesTable[window.encodeURIComponent(m)]={})
var x=[]
for(var _ in r.plugins[g].downloads)x.push(r.plugins[g].downloads[_])
var w=t(m,"downloads")
f.series.push({type:"spline",yAxis:0,name:ithoughts_plugins_statizer.lang.labels.downloadSerie.format(m),data:x,pointStart:i(new Date).getTime()-x.length*p,pointInterval:p,id:w,color:"#"+r.colors.series[b][0]}),r.seriesTable[window.encodeURIComponent(m)].downloads={id:w,name:m}
var x=[]
for(var _ in r.plugins[g].active)x.push(r.plugins[g].active[_])
var w=t(m,"active")
f.series.push({type:"line",yAxis:1,name:ithoughts_plugins_statizer.lang.labels.activeSerie.format(m),step:"center",data:x,pointStart:i(new Date).getTime()-x.length*p,pointInterval:p,id:w,color:"#"+r.colors.series[b][1]}),r.seriesTable[window.encodeURIComponent(m)].active={id:w,name:m}
var y=.5,I=n(r.colors.series[b][2]),A={type:"flags",xAxis:1,fillColor:"rgba("+I.r+","+I.g+","+I.b+","+y+")",data:[],name:m,shape:"flag",zIndex:10+b+2}
for(var z in r.plugins[g].events.versions){var T=r.plugins[g].events.versions[z]
A.data.push({x:i(new Date(z)).getTime(),title:"v"+T,text:ithoughts_plugins_statizer.lang.labels.eventVersion.format(T,m)})}f.series.push(A)
var I=n(r.colors.series[b][3]),k={yAxis:0,type:"flags",onSeries:t(m,"downloads"),fillColor:"rgba("+I.r+","+I.g+","+I.b+","+y+")",data:[],name:m,shape:"circlepin",zIndex:10+b+0}
for(var z in r.plugins[g].events.downloads){var C=r.plugins[g].events.downloads[z]
k.data.push({x:i(new Date(z)).getTime(),title:C,text:ithoughts_plugins_statizer.lang.labels.eventDownloads.format(C,m)})}f.series.push(k)
var I=n(r.colors.series[b][4]),O={yAxis:1,type:"flags",onSeries:t(m,"active"),fillColor:"rgba("+I.r+","+I.g+","+I.b+","+y+")",data:[],name:m,shape:"squarepin",zIndex:10+b+1}
for(var z in r.plugins[g].events.actives){var D=r.plugins[g].events.actives[z]
O.data.push({x:i(new Date(z)).getTime(),title:D,text:ithoughts_plugins_statizer.lang.labels.eventActive.format(D,m)})}f.series.push(O)}$container.find(".chart").highcharts(f,function(e){r.chart=e
var t=[]
for(var i in r.plugins)cplugin=r.plugins[i],cplugin.active&&-1==t.indexOf("active")&&t.push("active"),cplugin.downloads&&-1==t.indexOf("downloads")&&t.push("downloads"),cplugin.events&&Object.keys(cplugin.events).length>0&&-1==t.indexOf("events")&&t.push("events")
var n=$container.find(".customLegend"),a=$($.parseHTML("<table></table>"))
n.append(a)
var o=""
for(serie in t){var l=t[serie]
ithoughts_plugins_statizer.lang.labels[t[serie]]&&(l=ithoughts_plugins_statizer.lang.labels[t[serie]]),o+='<th class="item-group" data-direction="column">'+l+"</th>"}a.append($.parseHTML("<tr><th></th>"+o+"</tr>"))
var d={}
$.each(e.series,function(e,t){var i=t.userOptions.id
if(i){var n=i.split("___")
d[window.decodeURIComponent(n[0])]||(d[window.decodeURIComponent(n[0])]={}),d[window.decodeURIComponent(n[0])][n[1]]={index:e,color:t.color}}else if(d[t.userOptions.name].events||(d[t.userOptions.name].events=[]),t.options.fillColor){var a=t.options.fillColor.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),\s*(\d*.?\d*)\)/)
a={r:parseInt(a[1]),g:parseInt(a[2]),b:parseInt(a[3]),a:parseFloat(a[4])},d[t.userOptions.name].events.push({index:e,color:"rgb("+a.r+","+a.g+","+a.b+")"})}else d[t.userOptions.name].events.push({index:e,color:t.color})
s(t)})
var p=""
for(var g in d){p+='<tr><th class="item-group" data-direction="line">'+g+"</th>"
for(var u in t){var c=t[u]
if(d[g][c])if(d[g][c].constructor===Array){for(var h=[],v=[],f=0,m=d[g][c].length;m>f;f++)h.push(d[g][c][f].index),v.push('<div style="display:inline-block;background-color:'+d[g][c][f].color+';width:25px;height:5px;border-radius:5px;"></div>')
p+='<td class="item" data-index="'+h.join(", ")+'" style="text-align:center">'+v.join()+"</td>"}else p+='<td class="item" data-index="'+d[g][c].index+'" style="text-align:center"><div style="display:inline-block;background-color:'+d[g][c].color+';width:25px;height:5px;border-radius:5px;"></div></td>'
else p+="<td></td>"}p+="</tr>"}a.append($.parseHTML(p)),$container.find(".customLegend  .item").click(function(){var t=this.getAttribute("data-index"),i=this.getAttribute("data-active")
null==i&&(i=!0),"false"===i&&(i=!1),"true"===i&&(i=!0),i=!i,this.setAttribute("data-active",i)
var n
t.indexOf(",")>-1?(n=t.split(","),n.forEach(function(e,t,i){i[t]=parseInt(e)})):n=[parseInt(t)]
for(var s=0,a=n.length;a>s;s++)serie=e.series[n[s]],serie.setVisible(i)}),$container.find(".customLegend  .item-group").click(function(){var e=this.getAttribute("data-active")
switch(null==e&&(e=!0),"false"===e&&(e=!1),"true"===e&&(e=!0),e=!e,this.setAttribute("data-active",e),this.getAttribute("data-direction")){case"line":$(this).parent().find(".item").attr("data-active",!e).click()
break
case"column":$(this).parent().parent().find("tr td.item:nth-child("+($(this).index()+1)+")").attr("data-active",!e).click()}})})}}}String.prototype.format=function(){for(var e=this,t=0;t<arguments.length;t++){var i=new RegExp("\\{"+t+"\\}","gi")
e=e.replace(i,arguments[t])}return e},Highcharts.setOptions({lang:ithoughts_plugins_statizer.lang.highcharts}),$('[id^="plugins_data-"][data-ajaxed="true"]').each(function(){var t=e(this.getAttribute("data-plugins")),i=e(this.getAttribute("data-details")),n=this.id
$.post(ithoughts_plugins_statizer.ajax,{action:"ithoughts_plugins_statizer-get_chart_ajax",data:{plugins:t,details:i,chartId:n}},function(e){e.success?(ithoughts_plugins_statizer_plugins.push(e.data),a()):console.error("Error while getting chart via Ajax",e)})}),a()})
